(function(){var c=null;function g(a){var b=j;function d(){}d.prototype=b.prototype;a.j=b.prototype;a.prototype=new d};function k(a){window.console&&window.console.log&&window.console.log(a)};function j(a,b,d){this.type=a;this.c=!0;this.h=!1;this.x=b;this.y=d;this.d=Math.floor((d+60)/60)-1;this.e=Math.floor((b+60)/60)-1}j.prototype.f=function(){if(this.type){var a=new paper.Raster(this.type);a.position=new paper.Point(a.size.width/2+this.x,a.size.height/2+this.y)}};j.prototype.log=function(a){k(a)};function m(a,b){j.call(this,"grass",a,b);this.c=!0}g(m);var n=[[{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"grass"},{type:"pathv"},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"}],[{type:"treem"},{},{},{},{},{},{},{},{},{},{},{},{type:"treem"},{},{type:"grass"},{type:"pathv"},{},{type:"treem"},{},{},{},{},{},{},{},{},{type:"treem"}],[{type:"treem"},{},{type:"wall"},{type:"wallEnd"},{type:"wallEnd"},{type:"wallEnd"},
{type:"wallEnd"},{type:"wallEnd"},{type:"wall"},{type:"treem"},{},{},{},{},{},{type:"pathv"},{},{},{type:"treem"},{},{},{},{},{},{},{},{type:"treem"}],[{type:"treem"},{},{type:"wall"},{type:"grass"},{type:"grass"},{type:"grass"},{type:"grass"},{type:"grass"},{type:"wall"},{},{},{},{},{},{},{type:"pathv"},{},{},{},{},{},{},{},{},{type:"treem"},{},{type:"treem"}],[{type:"treem"},{},{type:"wall"},{type:"grass"},{type:"house"},{type:c},{type:c},{type:"grass"},{type:"wall"},{},{},{},{},{},{},{type:"pathv"},
{},{},{type:"treem"},{},{},{},{},{},{},{},{}],[{type:"treem"},{},{type:"wall"},{type:"grass"},{type:c},{type:c},{type:c},{type:"grass"},{type:"wallEnd"},{},{},{},{},{},{},{type:"pathv"},{},{},{},{},{},{},{},{},{},{},{}],[{type:"treem"},{},{type:"wallEnd"},{type:"grass"},{type:c},{type:c},{type:c},{type:"grass"},{},{},{},{},{},{type:"treem"},{},{type:"pathv"},{},{},{},{},{},{},{type:"treem"},{},{},{},{}],[{type:"treem"},{},{type:"treem"},{},{},{type:"pathv"},{},{},{},{},{},{},{},{},{},{type:"pathv"},
{},{},{},{},{},{},{},{},{},{},{}],[{type:"treem"},{},{type:"treem"},{},{},{type:"pathv"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathv"},{type:"treem"},{},{},{},{},{},{},{},{},{},{type:"treem"}],[{type:"treem"},{},{},{},{},{type:"pathv"},{type:"grass"},{type:"grass"},{},{},{},{},{},{},{type:"treem"},{type:"pathv"},{type:"treem"},{},{type:"grass"},{},{},{},{},{},{},{},{type:"treem"}],[{type:"treem"},
{},{type:"treem"},{},{},{type:"pathv"},{},{},{type:"treem"},{},{},{},{},{},{},{type:"treem"},{},{},{},{type:"grass"},{},{},{},{},{},{},{type:"treem"}],[{},{},{},{},{},{type:"pathv"},{},{},{},{},{},{},{},{},{},{},{},{type:"grass"},{type:"grass"},{},{},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"}],[{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathh"},{type:"pathv"},{type:"treem"},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{type:"treem"}],[{type:"treem"},
{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{}],[{},{},{},{},{},{},{type:"treem"},{},{},{},{},{type:"grass"},{},{},{},{},{},{type:"treem"},{},{type:"treem"},{},{},{},{},{},{},{type:"treem"}],[{},{},{},{},{},{type:"grass"},{},{},{},{},{},{type:"grass"},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{type:"treem"}],[{},{},{type:"treem"},{},{type:"treem"},{},{type:"treem"},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{},{type:"treem"}]];function o(a,b){j.call(this,"house",a,b);this.c=!1}g(o);function p(a){a=String(a);if(/^\s*$/.test(a)?0:/^[\],:{}\s\u2028\u2029]*$/.test(a.replace(/\\["\\\/bfnrtu]/g,"@").replace(/"[^"\\\n\r\u2028\u2029\x00-\x08\x10-\x1f\x80-\x9f]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:[\s\u2028\u2029]*\[)+/g,"")))try{return eval("("+a+")")}catch(b){}throw Error("Invalid JSON string: "+a);};function q(a){j.call(this,c,0,0);this.c=a;this.h=!0}g(q);function r(a,b){j.call(this,"treem",a,b);this.c=!0;if(n[this.d+1])n[this.d+1][this.e].type?n[this.d+1][this.e].c=!1:n[this.d+1][this.e]={type:"",item:new q(!1)};if(n[this.d+1]&&n[this.d+1][this.e+1])n[this.d+1][this.e+1].type?n[this.d+1][this.e+1].c=!1:n[this.d+1][this.e+1]={type:"",item:new q(!1)}}g(r);function s(){this.type="female"}s.prototype.f=function(){this.b=new paper.Raster(this.type);this.b.position=new paper.Point(this.b.size.width/2+600,this.b.size.height/2+600);this.move={a:c,g:0};var a=this;(new paper.Tool).onKeyDown=function(b){a.move.g==0&&(a.moveTo(b.key),a.move.a=="right"&&t.send('{"action" : "right"}'),a.move.a=="left"&&t.send('{"action" : "left"}'),a.move.a=="up"&&t.send('{"action" : "up"}'),a.move.a=="down"&&t.send('{"action" : "down"}'))}};
s.prototype.moveTo=function(a){this.move.a=a;this.move.g=60};
s.prototype.onFrame=function(){var a;if(a=this.move.g>0)a:{if(this.move.g==60){a=Math.floor(this.b.position.x/60);this.move.a=="right"?a=Math.floor((this.b.position.x+60)/60):this.move.a=="left"&&(a=Math.floor((this.b.position.x-60)/60));var b=Math.floor(this.b.position.y/60);this.move.a=="up"?b=Math.floor((this.b.position.y-60)/60):this.move.a=="down"&&(b=Math.floor((this.b.position.y+60)/60));if((a=n[b]?n[b][a]:c)&&a.item&&!a.item.c){this.move.a=c;this.move.g=0;a=!1;break a}}a=!0}a&&(this.move.a==
"right"&&(this.b.position.x+=4),this.move.a=="left"&&(this.b.position.x-=4),this.move.a=="up"&&(this.b.position.y-=4),this.move.a=="down"&&(this.b.position.y+=4),this.move.g-=4)};function u(){this.i=new s}var t=c;
u.prototype.draw=function(){paper.project.activeLayer.removeChildren();var a;t=new WebSocket("ws://canvastest.corn:8080");t.onopen=function(){k("Connection established!");t.send('{"action" : "newUser"}')};t.onmessage=function(b){k(b);b=p(b.data);b.action=="newUser"?(a=new s,a.f()):a&&a.moveTo(b.action)};v();w(this);x();var b=new Date,d=0,i=new paper.PointText({content:"FPS (0)",point:new paper.Point(20,30),fillColor:"black"}),e=this;paper.view.onFrame=function(){d++;var l=new Date,f=1E3/(l-b);b=l;
if(d>=5)i.content="FPS ("+Math.round(f).toString()+")",d=0;e.i.onFrame();if(a)a.onFrame()}};function v(){for(var a=Math.round(paper.view.size.width/60),b=0,d=Math.round(paper.view.size.height/60);b<d;b++){n[b]||(n[b]=[]);for(var i=0,e=a;i<e;i++)n[b][i]||(n[b][i]={})}}
function w(a){for(var b=0,d=0,i=[],e=0,l=n.length;e<l;e++){for(var f=0,z=n[e].length;f<z;f++){var h=n[e][f];if(!h.item||h.item&&h.item.h){if(h.type=="grass")n[e][f].item=new m(b,d),n[e][f].item.f();else if(h.type=="treem")n[e][f].item=new r(b,d),i.push(n[e][f].item);else if(h.type=="house")n[e][f].item=new o(b,d),n[e][f].item.f();else if(h.type)n[e][f].item=new j(h.type,b,d),h.h||n[e][f].item.f();if(h.c!=void 0)n[e][f].item.c=h.c}b+=60}b=0;d+=60}a.i.f();a=0;for(l=i.length;a<l;a++)i[a].f()}
function x(){for(var a=60,b=60;;)if((new paper.Path.Line(new paper.Point(0,b),new paper.Point(paper.view.size.width,b))).strokeColor="#5BB01B",b+=60,b>paper.view.size.height)break;for(;;)if((new paper.Path.Line(new paper.Point(a,0),new paper.Point(a,paper.view.size.height))).strokeColor="#5BB01B",a+=60,a>paper.view.size.width)break}var y=new u;paper.setup(document.getElementById("canvas"));y.draw();paper.view.draw();paper.view.play();paper.view.onResize=function(){y.draw()};})();
